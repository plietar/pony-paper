\documentclass[format=acmsmall, authordraft, authorversion]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amssymb}
\usepackage{mathpartir}

\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{CONF}
\acmArticle{1}
\acmYear{2018}
\acmMonth{1}
\acmDOI{}

\bibliographystyle{ACM-Reference-Format}
\citestyle{acmauthoryear}
\setcopyright{none}

\newcommand{\seq}[1]{\overline{#1}}
\newcommand{\Alias}{\mathcal{A}}
\newcommand{\Unalias}{\mathcal{U}}
\newcommand{\lambdas}{\lambda s}

\begin{document}
\title{Pony}
\author{Paul Li\'etar}

\begin{abstract}
Text of abstract \ldots.
\end{abstract}

\maketitle

\section{Static semantics}

\[ \begin{array}[t]{l@{\hspace{2mm}}l}
\mathtt{P} ::= \seq{\mathtt{CT}}\ \seq{\mathtt{AT}}\\
\mathtt{CT} ::= \mathtt{class}\ \mathtt{C}\ \seq{\mathtt{F}}\\
\mathtt{AT} ::= \mathtt{actor}\ \mathtt{A}\ \seq{\mathtt{F}}\ \seq{\mathtt{B}}\\
\mathtt{F} ::= \mathtt{var}\ f : \mathtt{S}\ \kappa\\
\mathtt{B} ::= \mathtt{be}\ b(\seq{x: \mathtt{S}\ \kappa}) \Rightarrow e\\
e ::= x \\
\qquad ~|~ x = e \\
\qquad ~|~ e.f \\
\qquad ~|~ e.f = e \\
\qquad ~|~ e.b(\seq{e}) \\
\qquad ~|~ e ; e\\
\qquad ~|~ \mathtt{new}\ \mathtt{S}
\end{array} \]

\begin{mathpar}
    \inferrule*[right=\textsc{T-Local}]{
        x \in \Gamma
    }{
        \Gamma \vdash x : \Gamma(x)
    }

    \inferrule*[right=\textsc{T-AsnLocal}]{
        \Gamma(x) = \mathtt{S}\ \kappa
        \\
        \Gamma \vdash_\Alias e : \mathtt{S}\ \kappa
    }{
        \Gamma \vdash x = e : \Unalias(\mathtt{S}\ \kappa)
    }

    \inferrule*[right=\textsc{T-Fld}]{
        \Gamma \vdash e : \mathtt{S}\ \lambda
        \\
        \textit{Field}(\mathtt{S}, f) = \mathtt{S}' \kappa
    }{
        \Gamma \vdash e.f : \mathtt{S}'\ (\lambda \vartriangleright \kappa)
    }

    \inferrule*[right=\textsc{T-AsnFld}]{
        \Gamma \vdash e : \mathtt{S}\ \lambda
        \\
        \textit{Field}(\mathtt{S}, f) = \mathtt{S}' \kappa
        \\
        \Gamma \vdash_\Alias e' : \mathtt{S}'\ \kappa
        \\\\
        \Gamma \vdash e : \mathtt{S}'\ \lambda'
        \\
        \lambda \triangleleft \Alias(\lambda')
    }{
        \Gamma \vdash e.f = e' : \mathtt{S}'\ (\lambda \blacktriangleright \kappa)
    }

    \inferrule*[right=\textsc{T-Ctor}]{
        \mathtt{C} \in \mathtt{P}
    }{
        \mathtt{new}\ \mathtt{C}: \mathtt{C}\ \mathtt{iso}-
    }

    \inferrule*[right=\textsc{T-Behv}]{
        \Gamma \vdash e : \mathtt{A}\ \lambda
        \\
        \seq{\Gamma \vdash_\Alias e : \mathtt{S}\ \lambda}
        \\\\
        \mathit{Behv}(A, b) = \seq{\mathtt{S}\ \lambda}
    }{
        \Gamma \vdash e.b(\seq{e}) : \mathtt{A}\ \lambda
    }

    \inferrule*[right=\textsc{T-Seq}]{
        \Gamma \vdash e : \mathtt{S}\ \lambda
        \\
        \Gamma \vdash e' : \mathtt{S}'\ \lambda'
    }{
        \Gamma \vdash e ; e' : \mathtt{S}'\ \lambda'
    }
\end{mathpar}

\section{Soundness}
\subsection{Paths}

\[
    p ::= \mathtt{this} \mid x \mid p . f
\]

\subsection{Visibility}
\begin{mathpar}
    \inferrule*[right=\textsc{V-This}]{
        \iota \in \chi
    }{
        \Delta, \chi, \iota \vdash \iota : \{ \mathtt{ref} \}, \mathtt{this}
    }

    \inferrule*[right=\textsc{V-Fld}]{
        \Delta, \chi, \iota \vdash \iota' : \lambdas, p
        \\
        \chi(\iota', f) = \iota''
        \\\\
        \mathit{Field}(\chi(\iota)\downarrow_1, f) = \mathtt{S}\ \kappa
    }{
        \Delta, \chi, \iota \vdash \iota'' : \lambdas \circ \kappa, p.f
    }

    \inferrule*[right=\textsc{V-Local}]{
        \chi(\alpha, x) = \iota
        \\
        \Delta(\alpha, x) = \mathtt{S}\ \kappa
    }{
        \Delta, \chi, \alpha \vdash \iota : \{ \kappa, \Unalias(\kappa) \}, x
    }

    \inferrule*[right=\textsc{V-Active}]{
        \chi(\alpha, t_a) = \iota
        \\
        \Delta(\alpha, t_a) = \mathtt{S}\ \lambda
    }{
        \Delta, \chi, \alpha \vdash \iota : \{ \lambda \}, t_a
    }
\end{mathpar}

\subsection{Well-formed visibility}
$\textit{WFV}(\Delta, \chi)$ iff $\forall \alpha, \alpha', \iota, p, p', \lambdas, \lambdas', \iota_0, p_0, \lambda_0$
\begin{enumerate}
    \item If $\alpha \neq \alpha'$
        and $\Delta, \chi, \alpha \vdash \iota : \lambdas, p$
        and $\Delta, \chi, \alpha' \vdash \iota : \lambdas', p'$
        then $\lambdas \sim_g \lambdas'$.

    \item If $\Delta, \chi, \alpha \vdash \iota_0 : \lambdas_0, p_0$
        and $\textit{Writable}(\lambdas_0)$
        and $\Delta, \chi, \iota_0 \vdash \iota : \lambdas, p$
        and $\Delta, \chi, \iota_0 \vdash \iota : \lambdas', p'$
        then either
        \begin{enumerate}
            \item $\lambdas \sim_l \lambdas'$ or
            \item $\chi, \alpha \vdash p \sim p'$
        \end{enumerate}
\end{enumerate}

\end{document}
